<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Login - Asisten Fisika Lab 2</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon-phi.svg" type="image/svg+xml">
    <script type="module" src="firebase-init.js"></script>
    <script type="module" src="theme.js"></script>
    <script type="module">
    import { initNightMode } from './theme.js';
    import { loginWithNRP, getCurrentUser } from './auth.js';

        initNightMode();

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('loginForm');
            if (getCurrentUser()) {
                window.location.href = 'home.html';
                return;
            }
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const nrp = document.getElementById('nrp').value.trim();
                const password = document.getElementById('password').value;
                try {
                    await loginWithNRP(nrp, password);
                    window.location.href = 'home.html';
                } catch (error) {
                    // Firebase Auth errors have codes
                    if (error.code === 'auth/user-not-found') {
                        alert('User belum terdaftar. Silakan daftar terlebih dahulu.');
                        window.location.href = 'signup.html';
                    } else if (error.code === 'auth/wrong-password') {
                        alert('Password salah');
                    } else {
                        alert('Terjadi kesalahan saat login: ' + (error.message || error.code));
                    }
                }
            });

            document.getElementById('goSignup').addEventListener('click', () => {
                window.location.href = 'signup.html';
            });
        });
    </script>
</head>
<body>
    <!-- fixed night mode toggle (outside container) -->
    <div class="fixed-night-toggle">
        <button id="nightModeToggle" class="switch" role="switch" aria-checked="false" aria-label="Toggle night mode" title="Toggle night mode">
            <span class="slider" aria-hidden="true">
                <span class="icon icon-moon">🌙</span>
                <span class="icon icon-sun">☀️</span>
                <span class="knob" aria-hidden="true"></span>
            </span>
        </button>
    </div>

    <div class="auth-wrap">
        <div class="auth-card">
            <div class="auth-logo" aria-hidden="true">🎓</div>
            <h1 class="auth-title">Asisten Fisika Lab 2</h1>
            <p class="auth-subtitle">Masuk ke akun Anda</p>

            <form id="loginForm" class="auth-form">
                <label class="field">NRP
                    <input id="nrp" class="auth-input" required placeholder="Masukkan NRP Anda">
                </label>
                <label class="field">Password
                    <input id="password" class="auth-input" type="password" required placeholder="Masukkan password Anda">
                </label>

                <p style="margin-top:12px">
                    <button class="btn auth-btn" type="submit">Masuk</button>
                </p>
                <p style="margin-top:8px;text-align:center">
                    <button type="button" id="goSignup" class="btn secondary" style="width:160px">Daftar</button>
                </p>
            </form>
        </div>
    </div>
</body>
</html>